---
layout: post
title: Use an ATTiny45 to auto-boot a NAS200 on power up
date: '2013-09-21T15:14:00.003+01:00'
author: jimbuzz
tags: 
modified_time: '2013-09-23T10:48:19.136+01:00'
thumbnail: http://4.bp.blogspot.com/-2bO7LAGCh2s/Uj2idaRpEYI/AAAAAAAABEk/-O5yZzVLj5M/s72-c/2013-09-20+14.46.41.jpg
blogger_id: tag:blogger.com,1999:blog-4676883399643590331.post-4263593033574471397
blogger_orig_url: http://parkyjimbo.blogspot.com/2013/09/attiny45-auto-boot-on-nas200.html
---

I make no guarantees for the information contained herein, I also cannot be held responsible for data loss as a result of your actions, we make our own decisions.<br /><br />I needed a way of booting the Linksys NAS200 automatically when powered up. As standard from Linksys the NAS200 just stays off when powered up. The Power button on the back left hand side when looking at the rear of the NAS200 needs to be pressed to start the NAS. I often found that when I tried to connect to the NAS it was powered off usually due to a power outage that occurred through the night. I would then have to go upstairs to power it on and wait for it's disk check to finish before I could actually use it. So I set out to fix this inconvenient feature of the NAS200.&nbsp; First power off and disconnect the power supply then remove the hard drives so they don't get damaged. I numbered the drives 1 and 2 to match the bay they came out of before removal just to be sure they went back into the correct drive bay.&nbsp; I proceeded to open up the case of the NAS. This involved removing the silver painted base cover using a screwdriver to lift the plastic sprung pillars out and then slide the cover to the front of the NAS. Four screws included one covered by a warranty sticker (<span style="color: red;"> only proceed if you are happy having no warranty and only if you are confident of success </span>) are removed. This allowed removal of drive bay 2, be careful of the power wires to PCB and SATA connector. Another four screws are removed to remove drive bay 1, again be careful of SATA and power cables. This will allow the main PCB to be accessed. Four screws are removed and this allows the PCB to be removed. An 8 pin socket was procured, pin 4 was soldered to the rear of one of the PCB mounted USB socket, pin 8 was connected to the 5V pin on the LM7805 voltage regulator see the picture below.<br /><br /><table align="center" cellpadding="0" cellspacing="0" class="tr-caption-container" style="margin-left: auto; margin-right: auto; text-align: center;"><tbody><tr><td style="text-align: center;"><a href="http://4.bp.blogspot.com/-2bO7LAGCh2s/Uj2idaRpEYI/AAAAAAAABEk/-O5yZzVLj5M/s1600/2013-09-20+14.46.41.jpg" imageanchor="1" style="margin-left: auto; margin-right: auto;"><img border="0" height="239" src="http://4.bp.blogspot.com/-2bO7LAGCh2s/Uj2idaRpEYI/AAAAAAAABEk/-O5yZzVLj5M/s320/2013-09-20+14.46.41.jpg" width="320" /></a></td></tr><tr><td class="tr-caption" style="text-align: center;">NAS200 ATTiny45 in Socket</td></tr></tbody></table><br />Pin 5 is connected to the conductor of the power push button at the rear of the PCB via a flexible insulated wire, I soldered it to the top of the push button.<br /><br />The ATTiny45 was programmed using an Arduino Uno programmed with the ISP Sketch, it's in the Arduino IDE examples, remember to choose the correct board and serial port in the IDE. See my previous <a href="http://parkyjimbo.blogspot.co.uk/2013/09/programming-attiny45-using-arduino-uno.html" target="_blank">post</a> on how to program the ATTiny45 with the Arduino Uno Board. <br /><br />The AutoPowerON.ino sketch basically sets up the port pins we are using as inputs this gives us the high impedance state so the pins don't affect the NAS200 power up or switch off function using the button. After 10 seconds (just to be sure the power has settled) from power being applied the pins on the ATTiny45 being used are set as outputs and PB0 PB1 go low and high respectively for half a second. They then return to high impedance state, the NAS200 has begun booting. After this the program in the ATTiny45 is then caught in an infinite loop, this ensures the pins are only pulsed once for each power cycle.<br />Note* I only use pin 5 this is the active low output, pin 6 can be used for circuits that may need an active high 5V pulse.<br />Code I used is pasted below I saved it as AutoPowerON.ino :-<br /><br /><pre style="background-color: #eeeeee; border: 1px dashed #999999; color: black; font-family: Andale Mono, Lucida Console, Monaco, fixed, monospace; font-size: 12px; line-height: 14px; overflow: auto; padding: 5px; width: 100%;"><code>/*<br /> NOTE* This Sketch will pulse a Pin low on the ATiny45<br /> This is to auto power up a NAS box to ensure it<br /> is available after a power cut. It normally has to be<br /> turned on by pressing the power button.<br /> If using an Arduino to program these devices you need to <br /> program the ISP Sketch found in the IDE onto the Arduino <br /> first. <br /> <br /> So the circuit will pulse a pin low after a<br /> predetermined amount of time say 10 Seconds<br /> <br /> This pin will be connected the same part of<br /> the NAS box's push button circuit to simulate<br /> a button press.<br /> We only want to do this procedure once on every power up.<br /> hence the capture while loop at the end of the loop function.<br /> <br />  +5V---------------------+<br />                       Vcc|<br />                     +----------+<br />                 PB2 |    8     |PB4<br />               +-----|7        3|----+<br />                 PB1 | ATTiny45 |PB3               <br />               +-----|6        2|----+             <br />TO               PB0 |          |PB5             <br />Push Button    +-----|5        1|----+          <br />                     |    4     |    <br />                     +----------+  <br />                       GND|          <br />   Ground-----------------+                          <br /><br />(Wiring Diagram for Auto Power On Circuit)<br /> <br /> By Jim Park jim (dot) buzz (at) gmail (dot) com<br /> Coded :- 18/09/13<br /> <br /> */<br /> <br />int PowerPin = 0;          // Pin 5 to power up the NAS if it's active Low  <br />int PowerPinInv = 1;       // Pin 6 to power up the NAS if it's active High<br /><br />void setup() {<br />// declare pins as O/P's or I/P's<br />  pinMode(PowerPin, INPUT);           // HI-Z pin<br />  pinMode(PowerPinInv, INPUT);        // HI-Z pin<br />}<br /><br />void loop() {<br />// Now delay for 10 Seconds<br />  delay(10000);                       // 10 second delay to be sure power is stable<br />  pinMode(PowerPin, OUTPUT);          // Remove HI-Z state from pin<br />  pinMode(PowerPinInv, OUTPUT);       // Remove HI-Z state from pin<br />  digitalWrite(PowerPin, LOW);        // Active Low on Pin 5<br />  digitalWrite(PowerPinInv, HIGH);    // Active High on Pin 6<br />  delay(500);                         // Half a second delay<br />  pinMode(PowerPin, INPUT);           // Back into HI-Z state<br />  pinMode(PowerPinInv, INPUT);        // Back into HI-Z state<br />  while(true){}       // Capture for ever......and..ever.........<br />}<br /></code></pre><br /><br />The programmed ATTiny45 is inserted into the socket carefully ensuring that pin 1 on the ATTiny45 goes into pin 1 on the Socket ( see the photo above ). The unit was tested by plugging in the power to the NAS, after 10 seconds the familiar boot beep with the flashing leds occurred. After the full boot the NAS was available on the network all without having to press the power button. :)