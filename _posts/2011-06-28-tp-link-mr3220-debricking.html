---
layout: post
title: TP-Link MR3220 Debricking
date: '2011-06-28T17:20:00.027+01:00'
author: jimbuzz
tags: 
modified_time: '2012-08-27T13:36:43.339+01:00'
thumbnail: http://2.bp.blogspot.com/-iWGM4sbs-uo/Tgwxofh61cI/AAAAAAAAAGw/SM95k_uh1MU/s72-c/IMG_20110628_172144.jpg
blogger_id: tag:blogger.com,1999:blog-4676883399643590331.post-8444439630732173130
blogger_orig_url: http://parkyjimbo.blogspot.com/2011/06/tp-link-mr3220-debricking.html
---

I bricked my MR3220 router with an OpenWRT firmware upload. I did manage to get it back by soldering a 4 pin header on its pcb to allow connection to its serial port. I used a Sparkfun <a href="http://www.sparkfun.com/products/9873">FTDI Basic Breakout - 3.3V USB to serial port converter</a> . I used minicom in Ubuntu 11.04 to communicate with the MR3220.<br /><div class="separator" style="clear: both; text-align: center;"><a href="http://2.bp.blogspot.com/-iWGM4sbs-uo/Tgwxofh61cI/AAAAAAAAAGw/SM95k_uh1MU/s1600/IMG_20110628_172144.jpg" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="200" src="http://2.bp.blogspot.com/-iWGM4sbs-uo/Tgwxofh61cI/AAAAAAAAAGw/SM95k_uh1MU/s200/IMG_20110628_172144.jpg" width="150" /></a></div>Photo showing the FTDI Basic Breakout - 3.3V USB to serial port converter.<br /><b>MR3220 Debricking Procedure</b><br /><b>Do this:</b><br />- Power off the router<br />- Connect the serial cable to the router and the computer <br />- Connect the Ethernet cable to the router and the computer<br />- Set the IP address of the NIC in your computer fixed at 192.168.1.27<br />- Start the tftpd server I used <a href="http://code.google.com/p/tftpgui/">tftpgui</a> and placed the firmware from the <a href="http://www.tp-link.com/support/download.asp?a=1&amp;m=TL-MR3220">TP-Link website</a> renamed to code.bin in the root directory of the tftp server as defined in its settings.<br />I used info obtained from <a href="http://wiki.openwrt.org/toh/tp-link/tl-mr3420">OpenWRT Wiki</a> and the procedure I used is below<br />- Start minicom with parameters 8 bit, no parity, one stop bit, 115200 baud, no flow control and no xon-xoff.<br />- Power the router on<br />- Boot messages will appear on the minicom terminal<br />- When the message "autoboot in 1 second .." appears quickly enter password tpl you will have to type quickly. This should interrupt the boot process and you should see the prompt:<br /><i>ar7100&gt;</i> <br /><br /><b>To program the new image:</b><br />Erase the memory<br /><i>ar7100&gt; erase 0x9f020000 +0x3c0000  </i><br />Load the new firmware<br /><i>ar7100&gt; tftpboot 0x81000000 code.bin</i><br />Copy memory bytes into flash memory<br /><i>ar7100&gt; cp.b 0x81000000 0x9f020000 0x3c0000 </i><br />Boot kernel image from flash memory location<br /><i>ar7100&gt; bootm 0x9f020000</i><br /><br /><b>To transfer image via Kermit (Serial Port)</b><br />You set the router up to receive the file via Minicom using the following commands. Erase the memory<br /><i>ar7100&gt; erase 0x9f020000 +0x3c0000  </i><br />Now load the binary file <br /><i>loadb 0x81000000</i><br />Exit Minicom Ctrl A Z X Fire up Kermit:- <i><br />set line /dev/ttyUSB0 <br />set speed 115200 <br />set carrier-watch off <br />set handshake none <br />set flow-control none <br />robust <br />set file type bin <br />set file name lit <br />set rec pack 1000 <br />set send pack 1000 <br />set window 5 <br />send openwrt-ar71xx-generic-tl-mr3220-v1-squashfs-factory.bin</i><br />Back to minicom:- <br />Copy memory bytes into flash memory<br /><i>ar7100&gt; cp.b 0x81000000 0x9f020000 0x3c0000 </i><br />Boot kernel image from flash memory location <br /><i>ar7100&gt; bootm 0x9f020000</i><br /><div class="separator" style="clear: both; text-align: center;"><a href="http://2.bp.blogspot.com/-eRqqW1mfuTc/Tgwx57oswcI/AAAAAAAAAG4/SR0Kw04D8uc/s1600/IMG_20110628_172208.jpg" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="150" src="http://2.bp.blogspot.com/-eRqqW1mfuTc/Tgwx57oswcI/AAAAAAAAAG4/SR0Kw04D8uc/s200/IMG_20110628_172208.jpg" width="200" /></a></div>Photo of MR3220 showing the four pin header location and pin outs.<br /><br />That's hopefully it and router should now work. <br />The router admin webpage is now on 192.168.1.254 , Note: I found that the password was still set to the password I had set when I first got the router and not the manufacturers default password as I expected with a reflash. 