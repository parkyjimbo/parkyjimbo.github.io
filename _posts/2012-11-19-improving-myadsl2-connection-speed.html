---
layout: post
title: Improving My ADSL2+ Connection Speed
date: '2012-11-19T10:17:00.000Z'
author: jimbuzz
tags: 
modified_time: '2014-07-21T10:11:31.276+01:00'
thumbnail: http://2.bp.blogspot.com/-S_msHkAXg0Y/UokSMbMCfkI/AAAAAAAABMQ/pFvo_HXU774/s72-c/Xively.png
blogger_id: tag:blogger.com,1999:blog-4676883399643590331.post-1788800051528481273
blogger_orig_url: http://parkyjimbo.blogspot.com/2012/11/improving-myadsl2-connection-speed.html
---

I used a <a href="http://www.netgear.co.uk/home/products/wired-routers-and-modems/wired-routers/DG834.aspx#">Netgear DG843GT</a> Modem/Router that I purchased on eBay for Â£12 delivered. It had a faulty swollen power supply capacitor on the Broadcom modem chip area of the printed circuit board, this I replaced, it was a 1000uF at 6.3V electrolytic capacitor. I flashed the modem/router with DGTeam Firmware <a href="http://www.dgteam-mirror.talktalk.net/Home.html">Mirror</a>. I didn't like the new firmware's logos at the top of the DG843GT Web interface so I just blocked this frame in my browser to remove it from view :).<br />This firmware allows you to reduce the noise margin via the routers web interface and command line. I first logged the modems varying ADSL2+ snr over a period of about a week from a <a href="http://www.raspberrypi.org/" target="_blank">Raspberry Pi</a> using a shell script (shown below) to <a href="https://xively.com/">Xively</a>. See the Xively <a href="https://xively.com/dev/tutorials/">tutorial</a> for more information. The Xively data format is detailed <a href="https://xively.com/dev/docs/api/communicating/data_formats/">here</a>. The reason I wanted to record the data was to get a feel for the actual noise conditions on my telephone line over a period of time and to see what I was going to be up against.<br /><br />The Xively internet of everything concept takes a bit of understanding , I'm not sure I fully understand it yet. My attempt to describe it here is that a <b>feed</b> is a location on <a href="https://xively.com/">Xively</a> for your device to record its many data <b>channels</b> also known as <b>datastreams</b>. These channels can be various outputs from sensors on the device or data gleaned from the device itself. In this case I'm screen scraping the Modem/Router's browser based status page to get the SNR and Download speed values. I'm doing this using a few shell scripts running that loop every 5 minutes on a <a href="http://www.raspberrypi.org/">Raspberry PI</a> a low power <a href="http://en.wikipedia.org/wiki/Linux">Linux</a> device that runs 24-7.  <br /><br />To do this yourself you need to <a href="https://xively.com/signup/">signup</a> with <a href="https://xively.com/">Xively</a> to create your own account and password. After this you then create a feed for your DG843GT with two channels one called <b>SNR</b> (Signal to Noise Ratio) measured in dB (decibels) and the other is <b>speed</b> the download speed measured in kbps (kilo Bits Per Second).<br /><br />As part of the account set up process a Product ID , Product Secret , Serial Number and Activation Code is created as is a Feed ID ,<br />Feed URL in the form :-<br />https://xively.com/feeds/***Feed_Number***<br />and an API endpoint URL of the form :-<br />https://api.xively.com/v2/feeds/***Feed_Number***<br />An auto-generated device key for your ***Feed Number*** is also created to allow secure uploading of the readings from your remote device.<br /><br />The script RouterCall.sh uses a command <a href="http://en.wikipedia.org/wiki/Wget">wget</a> to automatically log in to the DG834GT Modem/Router and download the stattbl.htm page. This page is then scraped using various <a href="http://en.wikipedia.org/wiki/Cut_%28Unix%29">cut</a> commands to get the value into variables within the script which are then packaged up into a data.json file that is uploaded to Xively by running the cosm.sh script. The cosm script has the feed details and associated security key along with the reference to the data.json data file.     <br />The annotations on the screenshot images are as follows #1 is the API endpoint #2 is the device key for the feed number.<br /><br /><table align="center" cellpadding="0" cellspacing="0" class="tr-caption-container" style="margin-left: auto; margin-right: auto; text-align: center;"><tbody><tr><td style="text-align: center;"><a href="http://2.bp.blogspot.com/-S_msHkAXg0Y/UokSMbMCfkI/AAAAAAAABMQ/pFvo_HXU774/s1600/Xively.png" imageanchor="1" style="margin-left: auto; margin-right: auto;"><img border="0" src="http://2.bp.blogspot.com/-S_msHkAXg0Y/UokSMbMCfkI/AAAAAAAABMQ/pFvo_HXU774/s320/Xively.png" height="312" width="320" /></a></td></tr><tr><td class="tr-caption" style="text-align: center;">Screenshot of the Device Feed</td></tr></tbody></table><br />The following image is of the cosm script and shows #1 the API feed endpoint URL and&nbsp; #2 is the device key for the feed , this shows hopefully how they are linked.<br /><br /><br /><table align="center" cellpadding="0" cellspacing="0" class="tr-caption-container" style="margin-left: auto; margin-right: auto; text-align: center;"><tbody><tr><td style="text-align: center;"><a href="http://4.bp.blogspot.com/-n5cYL2mAD_A/UokSMBusgPI/AAAAAAAABMU/vMSt3KjpHB0/s1600/Cosm.png" imageanchor="1" style="margin-left: auto; margin-right: auto;"><img border="0" src="http://4.bp.blogspot.com/-n5cYL2mAD_A/UokSMBusgPI/AAAAAAAABMU/vMSt3KjpHB0/s320/Cosm.png" height="60" width="320" /></a></td></tr><tr><td class="tr-caption" style="text-align: center;">cosm,sh</td></tr></tbody></table><br /><br />Note the area of the graph below showing off scale and a flat line is where I was playing around with the Router. From the graph below one can see that before the noise margin reduction it was around 10dB, and you can see the reduction at night time due to interference from MW radio stations etc reducing the noise margin. You can also see where I reduce the noise margin down to the target 6dB, this is where my download speed increased from 5Mbps up to 7.4Mbps, what a result :). <br /><br />The connection has been rock solid for over a week with no line re-sync and a very low crc much in line with what I experienced with the higher noise margin and a lower speed.<br /><br /><div class="separator" style="clear: both; text-align: center;"><a href="http://3.bp.blogspot.com/-2KJtWPb5d6Q/UKoLPdMtJaI/AAAAAAAAANs/dODh_3n8S0o/s1600/ADSL.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" src="http://3.bp.blogspot.com/-2KJtWPb5d6Q/UKoLPdMtJaI/AAAAAAAAANs/dODh_3n8S0o/s320/ADSL.png" height="109" width="320" /></a></div><br /><br /><b>Shell Script RouterCall.sh</b><br /><pre style="background-color: #eeeeee; border: 1px dashed #999999; color: black; font-family: Andale Mono, Lucida Console, Monaco, fixed, monospace; font-size: 12px; line-height: 14px; overflow: auto; padding: 5px; width: 100%;"><code># This script uses another script cosm.sh to send data to the Cosm Website<br /># Note you have to create an account yourself and use this id for your script<br />#!/bin/sh<br />while [ true ]<br />do<br /># Create my data files<br />touch noise.txt speed.txt data.txt<br /># Get content of Stats Page from Router<br />wget --http-user=admin --http-passwd='********' http://192.168.1.1/stattbl.htm<br /># Get data into files<br />cat stattbl.htm | grep kbps | cut -d\&gt; -f3 | cut -dk -f1 | head -1 &gt; speed.txt<br />cat stattbl.htm | grep db | cut -d\&gt; -f3 | cut -d\&lt; -f1 | cut -dk -f1 | tail -2 | head -1 &gt; noise.txt<br /># Load Variable list with contents of speed.txt<br />noise=`cat noise.txt`<br />speed=`cat speed.txt`<br /># Send data to Cosm by creating a json file containing the data<br />echo -e {\"version\":\"1.0.0\",\"datastreams\": [\{\"id\":\"ADSL\",\"current_value\":\"$noise\"\},\{\"id\":\"speed\",\"current_value\":\"$speed\"\}]\} &gt; data.json<br /># Run other Shell script<br />cosm.sh<br /># Remove the created files to renew them next time<br />rm noise.txt data.txt speed.txt data.json stattbl.htm<br /># Wait for 5 minutes before looping again<br />sleep 300<br />done<br /></code></pre><br /><b>Shell Script cosm.sh</b><br /><pre style="background-color: #eeeeee; border: 1px dashed #999999; color: black; font-family: Andale Mono, Lucida Console, Monaco, fixed, monospace; font-size: 12px; line-height: 14px; overflow: auto; padding: 5px; width: 100%;"><code># Script to send Data to your Cosm feed page<br />#!/bin/sh<br />curl --request PUT --data-binary @data.json --header "X-ApiKey: ***********You use your Key Here************" --verbose http://api.cosm.com/v2/feeds/***Your Feed Number Here*******<br /></code></pre><br /><b>Update:</b> I have managed a consistent 8.227Mbps by reducing the noise margin to around 3dB, it is also a rock solid connection and is much better than my old Zyxel P-660HW T1 V2 at around 4Mbps, it also used to restart for no reason even when it was brand new. <br /><br /><b>Further Update:</b> I have now managed a consistent 9.139Mbps by further reducing the noise margin to around 2.4dB, it is still a solid connection. It was up at 9.9Mbps but this was not stable so it was reduced. These changes were made in the summer when static and atmospheric noise is at its highest on the frequencies used by ADSL2 so fingers crossed that it stays this way :).<br /><br /><b>Even Further Update</b><br />My broadband started playing up around the 1st of April 2014 and it took BT Openreach about 2 weeks to fix it, I am still trying to get a refund. I was effectively without broadband during this time due to excessive noise on my telephone line, it was very crackly like static on a radio. I did however use a 3G USB Dongle for my broadband over this time. My SNR logging came to the rescue as I could see exactly when it happened and what was occurring on the line. See my image of the the SNR below.<br /><div class="separator" style="clear: both; text-align: center;"><a href="http://4.bp.blogspot.com/-fANwsEXFh4k/U1P5RknGnBI/AAAAAAAABP0/BGl8Trn4Trc/s1600/Noise_Margin.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" src="http://4.bp.blogspot.com/-fANwsEXFh4k/U1P5RknGnBI/AAAAAAAABP0/BGl8Trn4Trc/s1600/Noise_Margin.png" height="109" width="320" /></a></div><div class="separator" style="clear: both; text-align: center;"></div><br /><div class="separator" style="clear: both; text-align: center;"></div>My system is now back but it is now only running around 3Mbps which is pretty rubbish. My line still has to go through a learning process so the equipment at the telephone exchange can eventually see the line is no longer noisy and so should allow higher speeds hopefully.&nbsp; <br /><br /><br /><b>&nbsp;</b><b>Even Further Further Update</b><br /><br />After over a full month of mediocre/sometimes non existent broadband I have finally got the speed I think I should. I contacted them on two separate occasions saying I had been capped since the fault at 3Mbps even after BT saying the cap had been removed. I told them I had the evidence for the cap not being removed when even after a router reset the speed was always 3Mbps +- a few kbps. This morning I was contacted by BT to say the cap had not indeed been removed but that it was now and could I restart the router. This I did, the speed immediately went to 10Mbps download and 1Mbps upload, thanks goodness, fingers crossed that it stays this way. Images of the broadband speed and SNR are shown below.<br /><br /><div class="separator" style="clear: both; text-align: center;"></div><div class="separator" style="clear: both; text-align: center;"><a href="http://4.bp.blogspot.com/--LUH3Nu1rDI/U2tMfeQWZWI/AAAAAAAABQg/o0oZst7u9f0/s1600/Download_Speed.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" src="http://4.bp.blogspot.com/--LUH3Nu1rDI/U2tMfeQWZWI/AAAAAAAABQg/o0oZst7u9f0/s1600/Download_Speed.png" height="109" width="320" /></a></div><br /><div class="separator" style="clear: both; text-align: center;"></div><br /><div class="separator" style="clear: both; text-align: center;"><a href="http://4.bp.blogspot.com/-v_lrf1r1kdU/U2tMztOlQ1I/AAAAAAAABQo/B_JEG1xkhsE/s1600/SNR.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" src="http://4.bp.blogspot.com/-v_lrf1r1kdU/U2tMztOlQ1I/AAAAAAAABQo/B_JEG1xkhsE/s1600/SNR.png" height="109" width="320" /></a></div><b> </b><br /><br /><b>New Router Installed</b><br />My old Netgear DG834GT started to disconnect at random, so I purchased a Billion 7800DXL modem router to replace it. This was installed and no tweaking of the SNR was necessary, I am getting a reliable 9.2Mbps download and 1.0Mbps upload so a good result. The added benefit of this is that this router has dual band wifi and 1Gbit ethernet ports so file transfers to and from my NAS which is also 1Gbit on the home network is pretty rapid.<b> </b><br /><br /><b>References Used: With grateful thanks</b><br /><br /><br /><a href="http://www.instructables.com/id/Making-a-datalogger-for-a-Kamstrup-meter-use-with-/step4/Preparing-your-Cosm-feed/">Making a datalogger for a Kamstrup electricity / gas meter with Raspberry Pi!</a><br /><br /><br /><a href="http://www.duncanjauncey.com/blog/archives/category/pi">Duncan Jauncey's Blog</a><br /><br /><br /><br />