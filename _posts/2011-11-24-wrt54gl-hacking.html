---
layout: post
title: WRT54GL Hacking
date: '2011-11-24T15:03:00.001Z'
author: jimbuzz
tags: 
modified_time: '2011-11-24T15:06:23.221Z'
blogger_id: tag:blogger.com,1999:blog-4676883399643590331.post-1425530826179747935
blogger_orig_url: http://parkyjimbo.blogspot.com/2011/11/wrt54gl-hacking.html
---

<b>Driver for SD card downloaded from here </b><br /><a href="http://wiki.openwrt.org/_media/oldwiki/openwrtdocs/customizing/hardware/mmc-v1.3.4-gpio2.tgz">mmc-v1.3.4-gpio2.tgz file</a><br /><br /><i>tar xzvf mmc-v1.3.4-gpio2.tgz</i>  <br /><i>cp mmc-v1.3.4-gpio2/mmc-v1.3.4-gpio2/mmc /lib/modules/2.4.37.4  </i><br /><i>insmod mmc</i> (comment: at this point check with dmesg if every thing is ok)  <br /><i>mkfs.ext3 dev/mmc/disc0/part1  </i><br /><br /><br /><br /><i>opkg update   </i>                     update the package list<br /><i>opkg install kmod-fs-ext3 </i>         install package ext3 filesystem<br /><i>insmod ext3</i>                        activate the module ext3<br /><i>lsmod </i>             List installed modules<br /><i>mkdir /mmc</i>                         create the directory /mmc<br /><i>echo "0x9c" > /proc/diag/gpiomask</i>  Mask the gpio for the SD card and Wifi<br /><i>insmod mmc</i>                         Activate the module mmc (sd card driver)<br /><i>mount /dev/mmc/disc0/part1 /mmc </i>   Mount the SD card to /mmc<br /><i>grep /mnt /proc/mounts</i>             List the mounts to check SD card is mounted<br /><br /><b>Mounting to External Media</b> <br /><a href="https://wiki.xkyle.com/Wrt54gl">Mount root to SD Card</a><br /><br /><i>#!/bin/sh<br />. /etc/functions.sh<br />mount proc /proc -t<br />insmod diag<br />echo 0x9c > /proc/diag/gpiomask<br />insmod mmc<br />insmod ext2<br />mount -o rw /dev/mmc/disc0/disc /mnt<br />[ -x /mnt/sbin/init ] && {    <br />. /bin/firstboot <br />pivot /mnt /mnt       <br />} <br />exec /bin/busybox init<br /></i><br /><br />We have to format the thing: <br /><i>opkg install e2fsprogs kmod-fs-ext2</i><br /><i>mkfs.ext2 /dev/mmc/disc0/disc</i> # See above for the correct partition path<br /><i>mount -t ext2 /dev/mmc/disc0/disc /mnt/</i><br /><br /><br />Now we are going to copy over the root stuff<br /><i>mkdir -p /tmp/root<br />mount -o bind /rom /tmp/root<br />cp /tmp/root/* /mnt -a<br />sync<br />umount /tmp/root<br />umount /mnt</i><br /><br /><a href="http://www.hendlsofen.de/WRT54GL/eng/WRT54GL_chroot.html">Another way of mounting root to SD Card</a><br /><br /><i>rm /sbin/init</i>  Remove this file<br /><br />File <i>/sbin/init</i>  Create this file script is below<br /><br /><i>#!/bin/sh<br />echo "0x9c" > /proc/diag/gpiomask<br />insmod mmc<br />insmod ext2<br />boot_dev="/dev/mmc/disc0/part1"<br /><br />sleep 15s<br />mount "$boot_dev" /mmc<br />[ -x /mmc/sbin/init ] && {<br />mount -o move /proc /mmc/proc && \<br />pivot_root /mmc /mmc/mmc && {<br />mount -o move /mmc/dev /dev<br />mount -o move /mmc/tmp /tmp<br />mount -o move /mmc/jffs2 /jffs2 2>&-<br />mount -o move /mmc/sys /sys 2>&-<br />}<br />}<br />exec /bin/busybox init</i><br /><br /><i>chmod a+x /sbin/init</i>   Make the file executable<br /><br /><i>reboot</i><br /><br /><br /><i>df -h </i>  You should see that <i>/dev/mmc/disc0/part1</i> is mounted to /<br /><br /><a href="https://openwrt.org/">OpenWRT Website</a><br /><br /><a href="http://downloads.openwrt.org/backfire/10.03.1-rc6/">OpenWRT Downloads</a><br /><br /><a href="http://downloads.openwrt.org/backfire/10.03.1-rc6/brcm-2.4/openwrt-brcm-2.4-squashfs.trx ">openwrt-brcm-2.4-squashfs.trx file</a>     This is a 2.4 Kernel<br /><br /><br /><br /><b>Flashing Firmware (This is a 2.4 Kernel)</b><br /><br />Script to clean nvram settings<br /><a href="wget http://downloads.openwrt.org/people/nbd/nvram-clean.sh    "></a>   <br /><br /><i>./nvram-clean.sh<br />nvram commit</i><br /><br /><br /><a href="wget http://downloads.openwrt.org/backfire/10.03.1-rc5/brcm-2.4/openwrt-brcm-2.4-squashfs.trx"></a><br /><i>sysupgrade /tmp/openwrt-brcm-2.4-squashfs.trx</i><br />or<br /><i>mtd write /tmp/openwrt-brcm-2.4-squashfs.trx</i><br /><br /><br />The commands below allows the use of a tftp server to flash firmware by allowing a delay in the startup to access tftp<br /><br /><i>nvram set boot_wait=on<br />nvram set boot_time=10<br />nvram commit && reboot</i>