---
layout: post
title: Rocks Cluster Config
date: '2010-12-10T12:12:00.004Z'
author: jimbuzz
tags: 
modified_time: '2010-12-10T12:21:10.948Z'
blogger_id: tag:blogger.com,1999:blog-4676883399643590331.post-8805943297152725844
blogger_orig_url: http://parkyjimbo.blogspot.com/2010/12/rocks-cluster-config.html
---

<b>Shutdown Cluster</b><br /><br /><i>/opt/rocks/sbin/cluster-fork shutdown</i><br /><br />or<br /><br /><i>/opt/rocks/sbin/cluster-fork poweroff</i> (if kernel and bios agree)<br /><br /><b>Compute node removal</b><br /><i>rocks remove host compute-0-14<br />insert-ethers –-remove=compute-0-14<br />insert-ethers –-update<br />rocks sync config</i><br /><br /><b>Add/remove Nodes</b><br />Remove node with  <br /><i>rocks remove host compute-0-14 </i><br />followed by<br /><i>rocks sync config </i><br />and then run <br /><i>insert-ethers --cabinet=0 --rank=14 </i><br />and then pxe boot it?<br /><br />Watch the <i>/var/log/daemon</i> log file for DHCPREQUEST from the MAC<br />address of that node. Once you see request and offer of the IP address<br /><i>instert-ethers</i> should show that it found new node. Then see if you are<br />seeing anything in <i>/var/log/httpd/ssl_request_log</i> from that IP<br />address. Fresh node should ask for a <i>kickstart.cgi</i><br />Check for dhcp requests etc<br /><i>tail -f /var/log/messages</i> <br /><br />Check Kickstart file is being correctly generated<br /><i>rocks list host profile compute-0-0 > /tmp/ks.cfg</i><br /><br />Check you can download kickstart file<br /><i>wget --no-check-certificate  https://localhost/install/sbin/public/kickstart.cgi</i><br /><br /><b>Sync Config</b> <br /><i>rocks sync config</i><br /><br /><b>Set node to be OS rescued or reinstalled</b><br /><i>rocks set host pxeboot compute-x-y action=rescue/install</i> <br /><br /><b>List all hosts On Cluster</b><br /><i>cat /etc/hosts</i>  <br /><br /><b>IP Address for Node</b><br /><i>host compute-0-3</i><br /><br /><br /><br />New Node Install No IP address received<br />The new node sometimes doesn't get a new ip address via dhcp during pxe boot. A look in the head nodes messages shows no leases available. To fix this do :-<br /><br /><i>/etc/init.d/syslog restart</i><br /><br /><b>Problem with Ganglia Webpage</b><br /><i>/etc/init.d/gmetad restart<br /><br />/etc/init.d/gmond restart</i><br /><br /><br /><b>Reinstall Node Problem</b> <br /><br />24/6/09<br /><br />Then we tried to insert it:<br /><i>insert-ethers --cabinet=0 --rank=14</i><br /><br />It still failed at "choose a language".<br /><br />It didn't show # symbol when <ctrl><alt><f2>.<br />Kickstart file not loading on compute node.<br /><br /><br /><i>ls -ld /root</i><br /><br />Gives … drwx------ 21 root root 4096 Jun 24 12:01 /root<br /><i>ls -ld /root/.my.cnf</i><br /><br />Gives … <i>-r--r----- 1 root apache 28 Nov 25  2008 /root/.my.cnf</i><br /><br />Problem with download of kickstart file was to do with /root permissions. <br /><br />was fixed with  <i>chmod o+r /root and chmod o+x /root</i><br /><br />After the above two commands were used root permissions were:-<br /><br /><i>drwx---r-x 21 root root 4096 Jun 24 12:01 /root</i><br /><br />This cured the install problem.<br /><br />Install <i>id_rsa.pub</i> in Nodes<br /><br />Now copy <i>id_rsa.pub</i> file from head node to compute node.<br /><br /><i>scp /root/.ssh/id_rsa.pub   root@compute-0-45 root@compute-0-45 ://root/.ssh/linux.pub</i><br /><br />Now Login to the compute node.<br /><br /><i>ssh compute-0-45</i><br /><br />Copy contents of <i>linux.pub</i> file and append them to the authorized_keys file.<br /><br /><i>cat /root/.ssh/linux.pub >> /root/.ssh/authorized_keys</i><br /><br /><br /><b>Restart Ganglia</b><br /><br />Sometimes the Ganglia web page from the head node shows all nodes as down but they can be sshed into and pinged via the console and seem very much alive!.<br /><br /><i>service gmond restart</i><br /><br /><i>service gmetad restart</i><br /><br /><b>Run a command on all nodes</b><br />This will run the cat command on all nodes and output the results on the head node and redirect the output to a file. This gives a list of hostnames and MAC addresses in a txt file.<br /><br /><i>[root@blub~]#cluster-fork cat /etc/sysconfig/network-scripts/ifcfg-eth0:0 | egrep  "compute|HWADDR" > HostHWaddr.txt</i><br /><br /><br /><br /><b>Debug Commands Installation</b><br /><br /><b>Console Use Keystroke</b><br />1<br /><b>Installation</b><br /><i>Cntl-Alt-F1</i><br />2<br /><b>Shell prompt</b><br /><i>Cntl-Alt-F2</i><br />3<br /><b>Installation log</b><br /><i>Cntl-Alt-F3</i><br />4<br /><b>System messages</b><br /><i>Cntl-Alt-F4</i><br />5<br /><b>Other messages</b><br /><i>Cntl-Alt-F5</i>