---
layout: post
title: PXE Boot a Dban image from an Ubuntu Server
date: '2012-07-31T17:21:00.001+01:00'
author: jimbuzz
tags: 
modified_time: '2012-08-06T12:31:50.228+01:00'
thumbnail: http://2.bp.blogspot.com/-QE6JSJYBfA8/UBjzlhn0MpI/AAAAAAAAANA/B02CiAQAsqk/s72-c/dhcpoffer.jpg
blogger_id: tag:blogger.com,1999:blog-4676883399643590331.post-1818989094835999606
blogger_orig_url: http://parkyjimbo.blogspot.com/2012/07/pxe-boot-dban-image-on-ubuntu.html
---

<table align="center" cellpadding="0" cellspacing="0" class="tr-caption-container" style="margin-left: auto; margin-right: auto; text-align: center;"><tbody><tr><td style="text-align: center;"><div style="text-align: left;"><br /></div><br /><br /><a href="http://2.bp.blogspot.com/-QE6JSJYBfA8/UBjzlhn0MpI/AAAAAAAAANA/B02CiAQAsqk/s1600/dhcpoffer.jpg" imageanchor="1" style="margin-left: auto; margin-right: auto;"><img alt="" border="0" height="150" src="http://2.bp.blogspot.com/-QE6JSJYBfA8/UBjzlhn0MpI/AAAAAAAAANA/B02CiAQAsqk/s200/dhcpoffer.jpg" title="Dhcp Offers from Ubuntu Server to Compute Nodes" width="200" /></a></td></tr><tr><td class="tr-caption" style="text-align: center;">&nbsp;Dhcp Offers from Ubuntu Server to Compute Nodes</td></tr></tbody></table><div style="color: #cc0000;"><b>****Note**** exercise extreme care with these notes I have made as you can boot and wipe any computer c</b><b>apable of net booting </b><b>without any keyboard input on the  private network if the machine in question is set to net-boot.&nbsp;</b></div><b style="color: #cc0000;">I ACCEPT NO RESPONSIBILITY FOR ANY ERRORS OR OMISSIONS , YOU HAVE BEEN WARNED!</b><i><br /></i><br /><br />The object of this blog entry was to remind me how to securely erase a cluster of headless compute nodes connected to a head node using a <a href="http://www.dban.org/" target="_blank">Dban</a> image <a href="http://en.wikipedia.org/wiki/Preboot_Execution_Environment" target="_blank">pxe</a> booted from the head node.<br /><br />I installed <a href="http://www.ubuntu.com/" target="_blank">Ubuntu</a> 12.04 Server on the head node. The Head Node's <i>eth0</i> was connected via Ethernet switches to the compute nodes on a private network in the range 192.168.1.0 and <i>eth1</i> was connected to the public network and it was set to receive an IP address via dhcp.<br /><br />Installation Requirements for the Head Node:-<i></i><br />Install an internet super server, tftp server, dhcp server and <a href="http://www.syslinux.org/wiki/index.php/SYSLINUX" target="_blank">syslinux</a> a boot loader. <br />&nbsp;The command to do this is :-<br /><i>sudo apt-get -y install inetutils-inetd tftpd-hpa dhcp3-server syslinux</i><br /><br /><i>&nbsp;</i>You have to extract some files from a Darik's Boot 'n' Nuke  image:-<br /><i>sudo mkdir /media/iso</i><br /><i>sudo mount -o loop /the/path/to/dBanfile.iso /media/iso </i><br /><br />In the directory<i> /var/lib/tftpboot </i>place the following files dban.bzi from the<i> /media/iso</i> directory and<i> the file pxelinux.0</i> from the /usr/lib/syslinux/ directory. Also place the remaining files from the iso image in <i>/var/lib/tftpboot/pxelinux.cfg</i><br /><br /><i>&nbsp;</i>Set the entries in the file named default in <i>the directory </i> <i>/var/lib/tftpboot/pxelinux.cfg</i><br /><br />PROMPT 0<i> </i><br />DEFAULT quick<br /><br />With <i>prompt</i> set to <i>0</i> there is no pause and the <i>default</i> setting is <i>quick</i> it can be <i>autonuke dban dod dod3pass dodshort gutman ops2 paranoid prng or zero</i>.<br />This means when it is run it goes straight to quick wipe so exercise extreme care when doing this as you can boot and wipe anything on the private network if the machine in question is set to netboot.<i> I set it to 0 as all the compute nodes were headless and keyboardless so I could not have a pause for keyboard input.</i><br /><br />The settings<i> in the file /etc/dhcp/dhcpd.conf</i>&nbsp; I required for the dhcp server are as follows :-<br /><i>ddns-update-style none;<br />option domain-name "home.local";<br />option domain-name-servers 192.168.1.1;<br />default-lease-time 86400;<br />max-lease-time 604880;<br />option time-offset -18000;<br />authoritative;<br />log-facility local7;<br />allow booting;<br />allow bootp;<br />subnet 192.168.1.0 netmask 255.255.255.0 {<br />range 192.168.1.10 192.168.1.100;<br />filename "pxelinux.0";<br />option root-path "/var/lib/tftpboot";<br />next-server 192.168.1.1;<br />}</i><br /><br /><i></i><br />In the tftp config file<i> /etc/default/tftpd-hpa </i>I required the following :- <i><br /></i><br /><i></i><br /><i>RUN_DAEMON="yes"<br />TFTP_USERNAME="tftp"<br />TFTP_DIRECTORY="/var/lib/tftpboot"<br />TFTP_ADDRESS="0.0.0.0:69"<br />TFTP_OPTIONS=""</i><i></i><br /><i><br /></i>The other dhcp config file <i>/etc/default/isc-dhcp-server</i><br />should contain :-<br /><i>INTERFACES="eth0"</i><br /><br /><i>&nbsp;</i>The ethernet settings file<i> /etc/network/interfaces</i><br />should contain :-<br /><i>&nbsp;auto lo<br />iface lo inet loopback</i><br /><i># This is the private network</i><br /><i># Its static ip address<br />iface eth0 inet static<br />address 192.168.1.1<br />netmask 255.255.255.0<br />auto eth0<br /># The public network interface</i><br /><i># It uses dhcp<br />auto eth1<br />iface eth1 inet dhcp</i><br /><i><br /></i><i>Note you will have to ensure that the compute nodes' bios is set to pxe boot on eth0 if that is the interface you are using. Once the Ubuntu Head Node is booted use tail -f /var/log/syslog</i> to track the progress of the compute nodes dhcp ip addresses being served as they are booted.<br /><br />This really saved me time when I had to securely erase a large number of machines before they were decommissioned and sent for recycling :).<br /><br />